<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
    />
    <title>Work Kawaii Tracker</title>

    <!-- Metaetiquetas para iOS (PWA) -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="apple-mobile-web-app-title" content="Work Tracker" />
    <meta name="theme-color" content="#fce7f3" />

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- FontAwesome Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <!-- Fuentes Kawaii -->
    <link
      href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@400;700&family=Fredoka:wght@400;600&display=swap"
      rel="stylesheet"
    />

    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            fontFamily: {
              kawaii: ["Comfortaa", "cursive"],
              chunky: ["Fredoka", "sans-serif"],
            },
            colors: {
              // Paleta Hello Kitty / Draculaura
              "kitty-bg": "#fff0f5",
              "kitty-card": "#ffffff",
              "kitty-accent": "#ff69b4",
              "kitty-text": "#d63384",

              // Paleta Kuromi
              "kuromi-bg": "#1a1a1a",
              "kuromi-card": "#2d2d2d",
              "kuromi-accent": "#a78bfa", // Lila ne√≥n
              "kuromi-text": "#e9d5ff",
              "kuromi-dark": "#000000",
            },
          },
        },
      };
    </script>

    <style>
      /* Estilos base y animaciones */
      body {
        font-family: "Comfortaa", cursive;
        -webkit-tap-highlight-color: transparent;
        transition:
          background-color 0.5s ease,
          color 0.5s ease;
      }

      /* Ocultar scrollbar pero permitir scroll */
      .no-scrollbar::-webkit-scrollbar {
        display: none;
      }
      .no-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }

      /* Animaci√≥n suave para inputs */
      input:focus {
        outline: none;
        transform: scale(1.02);
        transition: all 0.2s ease;
      }

      /* Estilo iOS para inputs de fecha/hora */
      input[type="date"],
      input[type="time"],
      input[type="number"] {
        appearance: none;
        -webkit-appearance: none;
      }

      /* Fondo con patr√≥n lindo (Lunares o Calaveras sutiles con CSS) */
      .bg-pattern-light {
        background-color: #fff0f5;
        background-image: radial-gradient(#ffb7b2 2px, transparent 2px);
        background-size: 20px 20px;
      }

      .dark .bg-pattern-dark {
        background-color: #18181b;
        background-image: radial-gradient(#4c1d95 2px, transparent 2px);
        background-size: 20px 20px;
      }

      /* Bot√≥n flotante animado */
      @keyframes float {
        0% {
          transform: translateY(0px);
        }
        50% {
          transform: translateY(-5px);
        }
        100% {
          transform: translateY(0px);
        }
      }
      .floating-icon {
        animation: float 3s ease-in-out infinite;
      }
    </style>
  </head>
  <body
    class="bg-pattern-light min-h-screen text-gray-800 dark:text-gray-100 transition-colors duration-500 pb-20 safe-area-padding"
  >
    <!-- √Årea segura superior (Notch) -->
    <div class="h-safe-top w-full"></div>

    <!-- HEADER / NAV -->
    <header
      class="fixed top-0 w-full z-50 bg-white/80 dark:bg-black/80 backdrop-blur-md border-b border-pink-200 dark:border-purple-900 shadow-sm transition-colors duration-500 pt-safe-top"
    >
      <div class="flex justify-between items-center px-6 py-4">
        <div class="flex items-center gap-2">
          <i
            class="fa-solid fa-heart text-kitty-accent dark:text-kuromi-accent text-2xl floating-icon"
          ></i>
          <h1
            class="font-chunky text-2xl text-kitty-text dark:text-kuromi-accent tracking-wide"
          >
            Workie
          </h1>
        </div>

        <!-- Bot√≥n Toggle Tema -->
        <button
          onclick="toggleTheme()"
          class="relative w-14 h-8 bg-pink-200 dark:bg-purple-900 rounded-full shadow-inner transition-colors duration-300 focus:outline-none"
        >
          <div
            id="toggle-circle"
            class="absolute top-1 left-1 w-6 h-6 bg-white rounded-full shadow-md transform transition-transform duration-300 flex items-center justify-center text-xs"
          >
            üéÄ
          </div>
        </button>
      </div>
    </header>

    <!-- CONTENIDO PRINCIPAL -->
    <main class="pt-24 px-5 max-w-md mx-auto space-y-6">
      <!-- TARJETA DE RESUMEN (Stats) -->
      <div
        class="bg-white dark:bg-zinc-800 rounded-3xl p-6 shadow-lg border-2 border-pink-100 dark:border-purple-900 relative overflow-hidden transition-colors duration-500"
      >
        <!-- Decoraci√≥n de fondo -->
        <div
          class="absolute -right-4 -top-4 text-8xl opacity-10 rotate-12 select-none"
        >
          <span class="dark:hidden">üíñ</span>
          <span class="hidden dark:block">üíÄ</span>
        </div>

        <h2
          class="text-sm font-bold uppercase tracking-widest text-gray-400 dark:text-gray-500 mb-1"
        >
          Total Ganado
        </h2>
        <div class="flex items-baseline gap-1">
          <span
            class="text-4xl font-chunky text-kitty-text dark:text-kuromi-accent"
            id="total-earnings"
            >0.00</span
          >
          <span class="text-xl font-bold text-gray-500">‚Ç¨</span>
        </div>
        <p class="text-xs text-gray-400 mt-2">
          En <span id="total-hours">0</span> horas trabajadas
        </p>
      </div>

      <!-- FORMULARIO DE ENTRADA -->
      <div
        class="bg-white/90 dark:bg-zinc-900/90 backdrop-blur rounded-3xl p-6 shadow-xl border border-pink-200 dark:border-purple-800 transition-colors duration-500"
      >
        <h3
          class="font-chunky text-xl text-center mb-4 text-gray-700 dark:text-white"
        >
          <i
            class="fa-solid fa-pen-fancy mr-2 text-pink-400 dark:text-purple-400"
          ></i
          >Nuevo Turno
        </h3>

        <!-- Configuraci√≥n R√°pida (Pago Hora) -->
        <div class="mb-4">
          <label class="text-xs font-bold text-gray-500 ml-2"
            >Pago por Hora (‚Ç¨)</label
          >
          <input
            type="number"
            id="hourly-rate"
            class="w-full bg-pink-50 dark:bg-zinc-800 rounded-2xl px-4 py-3 mt-1 font-bold text-lg text-kitty-text dark:text-kuromi-accent border-2 border-transparent focus:border-pink-300 dark:focus:border-purple-500 transition-colors placeholder-gray-400"
            placeholder="Ej: 10.50"
            step="0.50"
          />
        </div>

        <!-- Fecha -->
        <div class="mb-4">
          <label class="text-xs font-bold text-gray-500 ml-2">Fecha</label>
          <input
            type="date"
            id="work-date"
            class="w-full bg-gray-50 dark:bg-zinc-800 rounded-2xl px-4 py-3 mt-1 text-gray-700 dark:text-gray-200 border border-gray-100 dark:border-gray-700 focus:border-pink-300 dark:focus:border-purple-500"
          />
        </div>

        <!-- Horas (Grid) -->
        <div class="grid grid-cols-2 gap-4 mb-6">
          <div>
            <label class="text-xs font-bold text-gray-500 ml-2">Entrada</label>
            <input
              type="time"
              id="start-time"
              class="w-full bg-gray-50 dark:bg-zinc-800 rounded-2xl px-2 py-3 mt-1 text-center font-bold text-gray-700 dark:text-gray-200 border border-gray-100 dark:border-gray-700"
            />
          </div>
          <div>
            <label class="text-xs font-bold text-gray-500 ml-2">Salida</label>
            <input
              type="time"
              id="end-time"
              class="w-full bg-gray-50 dark:bg-zinc-800 rounded-2xl px-2 py-3 mt-1 text-center font-bold text-gray-700 dark:text-gray-200 border border-gray-100 dark:border-gray-700"
            />
          </div>
        </div>

        <!-- Bot√≥n Guardar -->
        <button
          onclick="addEntry()"
          class="w-full py-4 rounded-2xl bg-gradient-to-r from-pink-400 to-rose-400 dark:from-purple-600 dark:to-indigo-600 text-white font-chunky text-lg shadow-lg shadow-pink-200 dark:shadow-purple-900/50 transform active:scale-95 transition-all flex justify-center items-center gap-2"
        >
          <i class="fa-solid fa-check"></i> ¬°Apuntar!
        </button>
      </div>

      <!-- LISTA DE HISTORIAL -->
      <div class="pb-24">
        <div class="flex justify-between items-end mb-3 px-2">
          <h3 class="font-chunky text-lg text-gray-600 dark:text-gray-300">
            Historial
          </h3>

          <!-- Botonera Acciones -->
          <div class="flex gap-2">
            <button
              onclick="copyToClipboard()"
              class="text-xs bg-white dark:bg-zinc-800 px-3 py-1 rounded-full shadow text-blue-400 dark:text-blue-300 font-bold border border-pink-100 dark:border-purple-900 active:scale-95 flex items-center gap-1"
            >
              <i class="fa-regular fa-copy"></i> Copiar
            </button>
            <button
              onclick="exportData()"
              class="text-xs bg-white dark:bg-zinc-800 px-3 py-1 rounded-full shadow text-pink-500 dark:text-purple-400 font-bold border border-pink-100 dark:border-purple-900 active:scale-95 flex items-center gap-1"
            >
              <i class="fa-solid fa-file-export"></i> CSV
            </button>
          </div>
        </div>

        <div id="entries-list" class="space-y-3">
          <!-- Las tarjetas se insertan aqu√≠ con JS -->
          <div class="text-center py-10 opacity-50">
            <i class="fa-solid fa-cat text-4xl mb-2"></i>
            <p>No hay turnos a√∫n...</p>
          </div>
        </div>

        <!-- Bot√≥n Borrar Todo (Discreto) -->
        <div class="text-center mt-8">
          <button
            onclick="clearAllData()"
            class="text-xs text-red-300 hover:text-red-500 underline decoration-dotted"
          >
            Borrar todo el historial
          </button>
        </div>
      </div>
    </main>

    <!-- SCRIPTS -->
    <script>
      // --- L√ìGICA DE LA APP ---

      // Elementos del DOM
      const toggleBtn = document.getElementById("toggle-circle");
      const listContainer = document.getElementById("entries-list");
      const totalEarningsEl = document.getElementById("total-earnings");
      const totalHoursEl = document.getElementById("total-hours");

      // Inputs
      const rateInput = document.getElementById("hourly-rate");
      const dateInput = document.getElementById("work-date");
      const startInput = document.getElementById("start-time");
      const endInput = document.getElementById("end-time");

      // Estado
      let entries = JSON.parse(localStorage.getItem("workEntries")) || [];
      let savedRate = localStorage.getItem("hourlyRate") || "";
      let isDark = localStorage.getItem("theme") === "dark";

      // Inicializaci√≥n
      window.onload = () => {
        // Establecer fecha de hoy por defecto
        dateInput.valueAsDate = new Date();

        // Cargar tasa guardada
        if (savedRate) rateInput.value = savedRate;

        // Cargar tema
        applyTheme();

        // Renderizar lista
        renderEntries();
      };

      // --- GESTI√ìN DEL TEMA ---
      function toggleTheme() {
        isDark = !isDark;
        localStorage.setItem("theme", isDark ? "dark" : "light");
        applyTheme();
      }

      function applyTheme() {
        const html = document.documentElement;
        const body = document.body;

        if (isDark) {
          html.classList.add("dark");
          body.classList.remove("bg-pattern-light");
          body.classList.add("bg-pattern-dark");

          // Animaci√≥n bot√≥n
          toggleBtn.style.transform = "translateX(24px)";
          toggleBtn.innerText = "üíÄ";
          toggleBtn.classList.remove("bg-white", "text-pink-500");
          toggleBtn.classList.add("bg-zinc-800", "text-purple-500");

          // Meta theme color
          document
            .querySelector('meta[name="theme-color"]')
            .setAttribute("content", "#18181b");
        } else {
          html.classList.remove("dark");
          body.classList.remove("bg-pattern-dark");
          body.classList.add("bg-pattern-light");

          // Animaci√≥n bot√≥n
          toggleBtn.style.transform = "translateX(0px)";
          toggleBtn.innerText = "üéÄ";
          toggleBtn.classList.remove("bg-zinc-800", "text-purple-500");
          toggleBtn.classList.add("bg-white", "text-pink-500");

          // Meta theme color
          document
            .querySelector('meta[name="theme-color"]')
            .setAttribute("content", "#fce7f3");
        }
      }

      // --- FUNCIONES PRINCIPALES ---

      function addEntry() {
        const rate = parseFloat(rateInput.value);
        const date = dateInput.value;
        const start = startInput.value;
        const end = endInput.value;

        // Validaciones
        if (!rate || !date || !start || !end) {
          alert("¬°Ups! üå∏ Por favor rellena todos los campos para guardar.");
          return;
        }

        // Guardar tarifa preferida
        localStorage.setItem("hourlyRate", rate);

        // Calcular horas
        const startTime = new Date(`2000-01-01T${start}`);
        let endTime = new Date(`2000-01-01T${end}`);

        // Si el turno termina al d√≠a siguiente (ej: 22:00 a 02:00)
        if (endTime < startTime) {
          endTime.setDate(endTime.getDate() + 1);
        }

        const diffMs = endTime - startTime;
        const diffHrs = diffMs / (1000 * 60 * 60); // Horas decimales
        const earned = diffHrs * rate;

        const newEntry = {
          id: Date.now(),
          date: date,
          start: start,
          end: end,
          rate: rate,
          hours: diffHrs.toFixed(2),
          earned: earned.toFixed(2),
        };

        entries.unshift(newEntry); // A√±adir al principio
        saveData();
        renderEntries();

        // Feedback visual suave
        startInput.value = "";
        endInput.value = "";
        // No borramos la fecha ni la tarifa porque suelen repetirse
      }

      function deleteEntry(id) {
        if (confirm("¬øSeguro que quieres borrar este registro? üíî")) {
          entries = entries.filter((entry) => entry.id !== id);
          saveData();
          renderEntries();
        }
      }

      function clearAllData() {
        if (
          confirm("¬øEST√ÅS SEGURA? Se borrar√°n todos tus datos para siempre. üò±")
        ) {
          entries = [];
          saveData();
          renderEntries();
        }
      }

      function saveData() {
        localStorage.setItem("workEntries", JSON.stringify(entries));
      }

      function renderEntries() {
        listContainer.innerHTML = "";

        let totalEarned = 0;
        let totalHours = 0;

        if (entries.length === 0) {
          listContainer.innerHTML = `
                    <div class="text-center py-10 opacity-50 flex flex-col items-center">
                        <i class="fa-solid fa-ghost text-4xl mb-2 text-pink-300 dark:text-purple-700"></i>
                        <p class="font-kawaii text-sm">Lista vac√≠a...</p>
                    </div>`;
        }

        entries.forEach((entry) => {
          totalEarned += parseFloat(entry.earned);
          totalHours += parseFloat(entry.hours);

          const dateObj = new Date(entry.date);
          const dayName = dateObj.toLocaleDateString("es-ES", {
            weekday: "short",
            day: "numeric",
            month: "short",
          });

          const card = document.createElement("div");
          card.className = `bg-white dark:bg-zinc-800 p-4 rounded-2xl shadow-sm border-l-4 border-pink-300 dark:border-purple-600 flex justify-between items-center animate-fade-in relative group`;

          card.innerHTML = `
                    <div>
                        <div class="text-xs font-bold text-gray-400 uppercase tracking-wide mb-1">${dayName}</div>
                        <div class="flex items-center gap-2">
                            <span class="font-chunky text-lg dark:text-gray-200">${entry.start} - ${entry.end}</span>
                            <span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-md text-gray-500">${entry.hours}h</span>
                        </div>
                        <div class="text-xs text-gray-400 mt-1">@ ${entry.rate}‚Ç¨/h</div>
                    </div>
                    <div class="text-right">
                        <div class="text-xl font-bold text-kitty-text dark:text-kuromi-accent">+${entry.earned}‚Ç¨</div>
                        <button onclick="deleteEntry(${entry.id})" class="text-gray-300 hover:text-red-400 dark:hover:text-red-400 mt-1 transition-colors p-2 -mr-2">
                            <i class="fa-solid fa-trash-can text-sm"></i>
                        </button>
                    </div>
                `;
          listContainer.appendChild(card);
        });

        // Actualizar totales generales
        totalEarningsEl.innerText = totalEarned.toFixed(2);
        totalHoursEl.innerText = totalHours.toFixed(1);
      }

      function exportData() {
        if (entries.length === 0) {
          alert("Nada que exportar todav√≠a üï∏Ô∏è");
          return;
        }

        let csvContent = "data:text/csv;charset=utf-8,";
        csvContent += "Fecha,Entrada,Salida,Horas,Tarifa,Ganado\n"; // Cabecera

        entries.forEach((e) => {
          const row = `${e.date},${e.start},${e.end},${e.hours},${e.rate},${e.earned}`;
          csvContent += row + "\n";
        });

        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", "mi_trabajo_kawaii.csv");
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      }

      function copyToClipboard() {
        if (entries.length === 0) {
          alert("Nada que copiar todav√≠a üï∏Ô∏è");
          return;
        }

        let text = "‚ú® WORKIE - Historial de Trabajo ‚ú®\n\n";
        let totalE = 0;
        let totalH = 0;

        entries.forEach((e) => {
          totalE += parseFloat(e.earned);
          totalH += parseFloat(e.hours);
          const dateObj = new Date(e.date);
          // Fecha bonita: 17/01/2026
          const dateStr = dateObj.toLocaleDateString("es-ES");

          text += `üìÖ ${dateStr}\n`;
          text += `‚è∞ ${e.start} - ${e.end} (${e.hours}h)\n`;
          text += `üí∞ ${e.earned}‚Ç¨ (a ${e.rate}‚Ç¨/h)\n`;
          text += `-------------------------\n`;
        });

        text += `\nüíñ RESUMEN TOTAL üíñ\n`;
        text += `üí∞ Ganado: ${totalE.toFixed(2)}‚Ç¨\n`;
        text += `‚è≥ Horas: ${totalH.toFixed(2)}h\n`;

        // M√©todo compatible con m√≥viles para copiar
        const el = document.createElement("textarea");
        el.value = text;
        el.setAttribute("readonly", "");
        el.style.position = "absolute";
        el.style.left = "-9999px";
        document.body.appendChild(el);
        el.select();

        try {
          document.execCommand("copy");
          alert("¬°Copiado! üìã\n\nYa puedes pegarlo en tus Notas del iPhone.");
        } catch (err) {
          alert("Uy, no pude copiarlo. Int√©ntalo de nuevo.");
        }

        document.body.removeChild(el);
      }
    </script>
  </body>
</html>
